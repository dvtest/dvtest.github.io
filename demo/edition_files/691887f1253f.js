!function(a,b,c,d){"use strict";function e(a,b,c){return setTimeout(k(a,c),b)}function f(a,b,c){return Array.isArray(a)?(g(a,c[b],c),!0):!1}function g(a,b,c){var e,f;if(a)if(a.forEach)a.forEach(b,c);else if(a.length!==d)for(e=0,f=a.length;f>e;e++)b.call(c,a[e],e,a);else for(e in a)a.hasOwnProperty(e)&&b.call(c,a[e],e,a)}function h(a,b,c){for(var e=Object.keys(b),f=0,g=e.length;g>f;f++)(!c||c&&a[e[f]]===d)&&(a[e[f]]=b[e[f]]);return a}function i(a,b){return h(a,b,!0)}function j(a,b,c){var d,e=b.prototype;d=a.prototype=Object.create(e),d.constructor=a,d._super=e,c&&h(d,c)}function k(a,b){return function(){return a.apply(b,arguments)}}function l(a,b){return typeof a==hb?a.apply(b?b[0]||d:d,b):a}function m(a,b){return a===d?b:a}function n(a,b,c){g(r(b),function(b){a.addEventListener(b,c,!1)})}function o(a,b,c){g(r(b),function(b){a.removeEventListener(b,c,!1)})}function p(a,b){for(;a;){if(a==b)return!0;a=a.parentNode}return!1}function q(a,b){return a.indexOf(b)>-1}function r(a){return a.trim().split(/\s+/g)}function s(a,b,c){if(a.indexOf&&!c)return a.indexOf(b);for(var d=0,e=a.length;e>d;d++)if(c&&a[d][c]==b||!c&&a[d]===b)return d;return-1}function t(a){return Array.prototype.slice.call(a,0)}function u(a,b,c){for(var d=[],e=[],f=0,g=a.length;g>f;f++){var h=b?a[f][b]:a[f];s(e,h)<0&&d.push(a[f]),e[f]=h}return c&&(d=b?d.sort(function(a,c){return a[b]>c[b]}):d.sort()),d}function v(a,b){for(var c,e,f=b[0].toUpperCase()+b.slice(1),g=0,h=fb.length;h>g;g++)if(c=fb[g],e=c?c+f:b,e in a)return e;return d}function w(){return lb++}function x(b,c){var d=this;this.manager=b,this.callback=c,this.element=b.element,this.target=b.options.inputTarget,this.domHandler=function(a){l(b.options.enable,[b])&&d.handler(a)},this.evEl&&n(this.element,this.evEl,this.domHandler),this.evTarget&&n(this.target,this.evTarget,this.domHandler),this.evWin&&n(a,this.evWin,this.domHandler)}function y(a){var b;return new(b=ob?M:pb?N:nb?P:L)(a,z)}function z(a,b,c){var d=c.pointers.length,e=c.changedPointers.length,f=b&vb&&d-e===0,g=b&(xb|yb)&&d-e===0;c.isFirst=!!f,c.isFinal=!!g,f&&(a.session={}),c.eventType=b,A(a,c),a.emit("hammer.input",c),a.recognize(c),a.session.prevInput=c}function A(a,b){var c=a.session,d=b.pointers,e=d.length;c.firstInput||(c.firstInput=D(b)),e>1&&!c.firstMultiple?c.firstMultiple=D(b):1===e&&(c.firstMultiple=!1);var f=c.firstInput,g=c.firstMultiple,h=g?g.center:f.center,i=b.center=E(d);b.timeStamp=kb(),b.deltaTime=b.timeStamp-f.timeStamp,b.angle=I(h,i),b.distance=H(h,i),B(c,b),b.offsetDirection=G(b.deltaX,b.deltaY),b.scale=g?K(g.pointers,d):1,b.rotation=g?J(g.pointers,d):0,C(c,b);var j=a.element;p(b.srcEvent.target,j)&&(j=b.srcEvent.target),b.target=j}function B(a,b){var c=b.center,d=a.offsetDelta||{},e=a.prevDelta||{},f=a.prevInput||{};(b.eventType===vb||f.eventType===xb)&&(e=a.prevDelta={x:f.deltaX||0,y:f.deltaY||0},d=a.offsetDelta={x:c.x,y:c.y}),b.deltaX=e.x+(c.x-d.x),b.deltaY=e.y+(c.y-d.y)}function C(a,b){var c,e,f,g,h=a.lastInterval||b,i=b.timeStamp-h.timeStamp;if(b.eventType!=yb&&(i>ub||h.velocity===d)){var j=h.deltaX-b.deltaX,k=h.deltaY-b.deltaY,l=F(i,j,k);e=l.x,f=l.y,c=jb(l.x)>jb(l.y)?l.x:l.y,g=G(j,k),a.lastInterval=b}else c=h.velocity,e=h.velocityX,f=h.velocityY,g=h.direction;b.velocity=c,b.velocityX=e,b.velocityY=f,b.direction=g}function D(a){for(var b=[],c=0;c<a.pointers.length;c++)b[c]={clientX:ib(a.pointers[c].clientX),clientY:ib(a.pointers[c].clientY)};return{timeStamp:kb(),pointers:b,center:E(b),deltaX:a.deltaX,deltaY:a.deltaY}}function E(a){var b=a.length;if(1===b)return{x:ib(a[0].clientX),y:ib(a[0].clientY)};for(var c=0,d=0,e=0;b>e;e++)c+=a[e].clientX,d+=a[e].clientY;return{x:ib(c/b),y:ib(d/b)}}function F(a,b,c){return{x:b/a||0,y:c/a||0}}function G(a,b){return a===b?zb:jb(a)>=jb(b)?a>0?Ab:Bb:b>0?Cb:Db}function H(a,b,c){c||(c=Hb);var d=b[c[0]]-a[c[0]],e=b[c[1]]-a[c[1]];return Math.sqrt(d*d+e*e)}function I(a,b,c){c||(c=Hb);var d=b[c[0]]-a[c[0]],e=b[c[1]]-a[c[1]];return 180*Math.atan2(e,d)/Math.PI}function J(a,b){return I(b[1],b[0],Ib)-I(a[1],a[0],Ib)}function K(a,b){return H(b[0],b[1],Ib)/H(a[0],a[1],Ib)}function L(){this.evEl=Kb,this.evWin=Lb,this.allow=!0,this.pressed=!1,x.apply(this,arguments)}function M(){this.evEl=Ob,this.evWin=Pb,x.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}function N(){this.evTarget=Rb,this.targetIds={},x.apply(this,arguments)}function O(a,b){var c=t(a.touches),d=this.targetIds;if(b&(vb|wb)&&1===c.length)return d[c[0].identifier]=!0,[c,c];var e,f,g=t(a.targetTouches),h=t(a.changedTouches),i=[];if(b===vb)for(e=0,f=g.length;f>e;e++)d[g[e].identifier]=!0;for(e=0,f=h.length;f>e;e++)d[h[e].identifier]&&i.push(h[e]),b&(xb|yb)&&delete d[h[e].identifier];return i.length?[u(g.concat(i),"identifier",!0),i]:void 0}function P(){x.apply(this,arguments);var a=k(this.handler,this);this.touch=new N(this.manager,a),this.mouse=new L(this.manager,a)}function Q(a,b){this.manager=a,this.set(b)}function R(a){if(q(a,Xb))return Xb;var b=q(a,Yb),c=q(a,Zb);return b&&c?Yb+" "+Zb:b||c?b?Yb:Zb:q(a,Wb)?Wb:Vb}function S(a){this.id=w(),this.manager=null,this.options=i(a||{},this.defaults),this.options.enable=m(this.options.enable,!0),this.state=$b,this.simultaneous={},this.requireFail=[]}function T(a){return a&dc?"cancel":a&bc?"end":a&ac?"move":a&_b?"start":""}function U(a){return a==Db?"down":a==Cb?"up":a==Ab?"left":a==Bb?"right":""}function V(a,b){var c=b.manager;return c?c.get(a):a}function W(){S.apply(this,arguments)}function X(){W.apply(this,arguments),this.pX=null,this.pY=null}function Y(){W.apply(this,arguments)}function Z(){S.apply(this,arguments),this._timer=null,this._input=null}function $(){W.apply(this,arguments)}function _(){W.apply(this,arguments)}function ab(){S.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function bb(a,b){return b=b||{},b.recognizers=m(b.recognizers,bb.defaults.preset),new cb(a,b)}function cb(a,b){b=b||{},this.options=i(b,bb.defaults),this.options.inputTarget=this.options.inputTarget||a,this.handlers={},this.session={},this.recognizers=[],this.element=a,this.input=y(this),this.touchAction=new Q(this,this.options.touchAction),db(this,!0),g(b.recognizers,function(a){var b=this.add(new a[0](a[1]));a[2]&&b.recognizeWith(a[2]),a[3]&&b.requireFailure(a[2])},this)}function db(a,b){var c=a.element;g(a.options.cssProps,function(a,d){c.style[v(c.style,d)]=b?a:""})}function eb(a,c){var d=b.createEvent("Event");d.initEvent(a,!0,!0),d.gesture=c,c.target.dispatchEvent(d)}var fb=["","webkit","moz","MS","ms","o"],gb=b.createElement("div"),hb="function",ib=Math.round,jb=Math.abs,kb=Date.now,lb=1,mb=/mobile|tablet|ip(ad|hone|od)|android/i,nb="ontouchstart"in a,ob=v(a,"PointerEvent")!==d,pb=nb&&mb.test(navigator.userAgent),qb="touch",rb="pen",sb="mouse",tb="kinect",ub=25,vb=1,wb=2,xb=4,yb=8,zb=1,Ab=2,Bb=4,Cb=8,Db=16,Eb=Ab|Bb,Fb=Cb|Db,Gb=Eb|Fb,Hb=["x","y"],Ib=["clientX","clientY"];x.prototype={handler:function(){},destroy:function(){this.evEl&&o(this.element,this.evEl,this.domHandler),this.evTarget&&o(this.target,this.evTarget,this.domHandler),this.evWin&&o(a,this.evWin,this.domHandler)}};var Jb={mousedown:vb,mousemove:wb,mouseup:xb},Kb="mousedown",Lb="mousemove mouseup";j(L,x,{handler:function(a){var b=Jb[a.type];b&vb&&0===a.button&&(this.pressed=!0),b&wb&&1!==a.which&&(b=xb),this.pressed&&this.allow&&(b&xb&&(this.pressed=!1),this.callback(this.manager,b,{pointers:[a],changedPointers:[a],pointerType:sb,srcEvent:a}))}});var Mb={pointerdown:vb,pointermove:wb,pointerup:xb,pointercancel:yb,pointerout:yb},Nb={2:qb,3:rb,4:sb,5:tb},Ob="pointerdown",Pb="pointermove pointerup pointercancel";a.MSPointerEvent&&(Ob="MSPointerDown",Pb="MSPointerMove MSPointerUp MSPointerCancel"),j(M,x,{handler:function(a){var b=this.store,c=!1,d=a.type.toLowerCase().replace("ms",""),e=Mb[d],f=Nb[a.pointerType]||a.pointerType,g=f==qb;e&vb&&(0===a.button||g)?b.push(a):e&(xb|yb)&&(c=!0);var h=s(b,a.pointerId,"pointerId");0>h||(b[h]=a,this.callback(this.manager,e,{pointers:b,changedPointers:[a],pointerType:f,srcEvent:a}),c&&b.splice(h,1))}});var Qb={touchstart:vb,touchmove:wb,touchend:xb,touchcancel:yb},Rb="touchstart touchmove touchend touchcancel";j(N,x,{handler:function(a){var b=Qb[a.type],c=O.call(this,a,b);c&&this.callback(this.manager,b,{pointers:c[0],changedPointers:c[1],pointerType:qb,srcEvent:a})}}),j(P,x,{handler:function(a,b,c){var d=c.pointerType==qb,e=c.pointerType==sb;if(d)this.mouse.allow=!1;else if(e&&!this.mouse.allow)return;b&(xb|yb)&&(this.mouse.allow=!0),this.callback(a,b,c)},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var Sb=v(gb.style,"touchAction"),Tb=Sb!==d,Ub="compute",Vb="auto",Wb="manipulation",Xb="none",Yb="pan-x",Zb="pan-y";Q.prototype={set:function(a){a==Ub&&(a=this.compute()),Tb&&(this.manager.element.style[Sb]=a),this.actions=a.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var a=[];return g(this.manager.recognizers,function(b){l(b.options.enable,[b])&&(a=a.concat(b.getTouchAction()))}),R(a.join(" "))},preventDefaults:function(a){if(!Tb){var b=a.srcEvent,c=a.offsetDirection;if(this.manager.session.prevented)return void b.preventDefault();var d=this.actions,e=q(d,Xb),f=q(d,Zb),g=q(d,Yb);return e||f&&g||f&&c&Eb||g&&c&Fb?this.preventSrc(b):void 0}},preventSrc:function(a){this.manager.session.prevented=!0,a.preventDefault()}};var $b=1,_b=2,ac=4,bc=8,cc=bc,dc=16,ec=32;S.prototype={defaults:{},set:function(a){return h(this.options,a),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(a){if(f(a,"recognizeWith",this))return this;var b=this.simultaneous;return a=V(a,this),b[a.id]||(b[a.id]=a,a.recognizeWith(this)),this},dropRecognizeWith:function(a){return f(a,"dropRecognizeWith",this)?this:(a=V(a,this),delete this.simultaneous[a.id],this)},requireFailure:function(a){if(f(a,"requireFailure",this))return this;var b=this.requireFail;return a=V(a,this),-1===s(b,a)&&(b.push(a),a.requireFailure(this)),this},dropRequireFailure:function(a){if(f(a,"dropRequireFailure",this))return this;a=V(a,this);var b=s(this.requireFail,a);return b>-1&&this.requireFail.splice(b,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(a){return!!this.simultaneous[a.id]},emit:function(a){function b(b){c.manager.emit(c.options.event+(b?T(d):""),a)}var c=this,d=this.state;bc>d&&b(!0),b(),d>=bc&&b(!0)},tryEmit:function(a){return this.canEmit()?this.emit(a):void(this.state=ec)},canEmit:function(){for(var a=0;a<this.requireFail.length;a++)if(!(this.requireFail[a].state&(ec|$b)))return!1;return!0},recognize:function(a){var b=h({},a);return l(this.options.enable,[this,b])?(this.state&(cc|dc|ec)&&(this.state=$b),this.state=this.process(b),void(this.state&(_b|ac|bc|dc)&&this.tryEmit(b))):(this.reset(),void(this.state=ec))},process:function(){},getTouchAction:function(){},reset:function(){}},j(W,S,{defaults:{pointers:1},attrTest:function(a){var b=this.options.pointers;return 0===b||a.pointers.length===b},process:function(a){var b=this.state,c=a.eventType,d=b&(_b|ac),e=this.attrTest(a);return d&&(c&yb||!e)?b|dc:d||e?c&xb?b|bc:b&_b?b|ac:_b:ec}}),j(X,W,{defaults:{event:"pan",threshold:10,pointers:1,direction:Gb},getTouchAction:function(){var a=this.options.direction;if(a===Gb)return[Xb];var b=[];return a&Eb&&b.push(Zb),a&Fb&&b.push(Yb),b},directionTest:function(a){var b=this.options,c=!0,d=a.distance,e=a.direction,f=a.deltaX,g=a.deltaY;return e&b.direction||(b.direction&Eb?(e=0===f?zb:0>f?Ab:Bb,c=f!=this.pX,d=Math.abs(a.deltaX)):(e=0===g?zb:0>g?Cb:Db,c=g!=this.pY,d=Math.abs(a.deltaY))),a.direction=e,c&&d>b.threshold&&e&b.direction},attrTest:function(a){return W.prototype.attrTest.call(this,a)&&(this.state&_b||!(this.state&_b)&&this.directionTest(a))},emit:function(a){this.pX=a.deltaX,this.pY=a.deltaY;var b=U(a.direction);b&&this.manager.emit(this.options.event+b,a),this._super.emit.call(this,a)}}),j(Y,W,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Xb]},attrTest:function(a){return this._super.attrTest.call(this,a)&&(Math.abs(a.scale-1)>this.options.threshold||this.state&_b)},emit:function(a){if(this._super.emit.call(this,a),1!==a.scale){var b=a.scale<1?"in":"out";this.manager.emit(this.options.event+b,a)}}}),j(Z,S,{defaults:{event:"press",pointers:1,time:500,threshold:5},getTouchAction:function(){return[Vb]},process:function(a){var b=this.options,c=a.pointers.length===b.pointers,d=a.distance<b.threshold,f=a.deltaTime>b.time;if(this._input=a,!d||!c||a.eventType&(xb|yb)&&!f)this.reset();else if(a.eventType&vb)this.reset(),this._timer=e(function(){this.state=cc,this.tryEmit()},b.time,this);else if(a.eventType&xb)return cc;return ec},reset:function(){clearTimeout(this._timer)},emit:function(a){this.state===cc&&(a&&a.eventType&xb?this.manager.emit(this.options.event+"up",a):(this._input.timeStamp=kb(),this.manager.emit(this.options.event,this._input)))}}),j($,W,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Xb]},attrTest:function(a){return this._super.attrTest.call(this,a)&&(Math.abs(a.rotation)>this.options.threshold||this.state&_b)}}),j(_,W,{defaults:{event:"swipe",threshold:10,velocity:.65,direction:Eb|Fb,pointers:1},getTouchAction:function(){return X.prototype.getTouchAction.call(this)},attrTest:function(a){var b,c=this.options.direction;return c&(Eb|Fb)?b=a.velocity:c&Eb?b=a.velocityX:c&Fb&&(b=a.velocityY),this._super.attrTest.call(this,a)&&c&a.direction&&jb(b)>this.options.velocity&&a.eventType&xb},emit:function(a){var b=U(a.direction);b&&this.manager.emit(this.options.event+b,a),this.manager.emit(this.options.event,a)}}),j(ab,S,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:2,posThreshold:10},getTouchAction:function(){return[Wb]},process:function(a){var b=this.options,c=a.pointers.length===b.pointers,d=a.distance<b.threshold,f=a.deltaTime<b.time;if(this.reset(),a.eventType&vb&&0===this.count)return this.failTimeout();if(d&&f&&c){if(a.eventType!=xb)return this.failTimeout();var g=this.pTime?a.timeStamp-this.pTime<b.interval:!0,h=!this.pCenter||H(this.pCenter,a.center)<b.posThreshold;this.pTime=a.timeStamp,this.pCenter=a.center,h&&g?this.count+=1:this.count=1,this._input=a;var i=this.count%b.taps;if(0===i)return this.hasRequireFailures()?(this._timer=e(function(){this.state=cc,this.tryEmit()},b.interval,this),_b):cc}return ec},failTimeout:function(){return this._timer=e(function(){this.state=ec},this.options.interval,this),ec},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==cc&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),bb.VERSION="2.0.2",bb.defaults={domEvents:!1,touchAction:Ub,inputTarget:null,enable:!0,preset:[[$,{enable:!1}],[Y,{enable:!1},["rotate"]],[_,{direction:Eb}],[X,{direction:Eb},["swipe"]],[ab],[ab,{event:"doubletap",taps:2},["tap"]],[Z]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var fc=1,gc=2;cb.prototype={set:function(a){return h(this.options,a),this},stop:function(a){this.session.stopped=a?gc:fc},recognize:function(a){var b=this.session;if(!b.stopped){this.touchAction.preventDefaults(a);var c,d=this.recognizers,e=b.curRecognizer;(!e||e&&e.state&cc)&&(e=b.curRecognizer=null);for(var f=0,g=d.length;g>f;f++)c=d[f],b.stopped===gc||e&&c!=e&&!c.canRecognizeWith(e)?c.reset():c.recognize(a),!e&&c.state&(_b|ac|bc)&&(e=b.curRecognizer=c)}},get:function(a){if(a instanceof S)return a;for(var b=this.recognizers,c=0;c<b.length;c++)if(b[c].options.event==a)return b[c];return null},add:function(a){if(f(a,"add",this))return this;var b=this.get(a.options.event);return b&&this.remove(b),this.recognizers.push(a),a.manager=this,this.touchAction.update(),a},remove:function(a){if(f(a,"remove",this))return this;var b=this.recognizers;return a=this.get(a),b.splice(s(b,a),1),this.touchAction.update(),this},on:function(a,b){var c=this.handlers;return g(r(a),function(a){c[a]=c[a]||[],c[a].push(b)}),this},off:function(a,b){var c=this.handlers;return g(r(a),function(a){b?c[a].splice(s(c[a],b),1):delete c[a]}),this},emit:function(a,b){this.options.domEvents&&eb(a,b);var c=this.handlers[a]&&this.handlers[a].slice();if(c&&c.length){b.type=a,b.preventDefault=function(){b.srcEvent.preventDefault()};for(var d=0,e=c.length;e>d;d++)c[d](b)}},destroy:function(){this.element&&db(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},h(bb,{INPUT_START:vb,INPUT_MOVE:wb,INPUT_END:xb,INPUT_CANCEL:yb,STATE_POSSIBLE:$b,STATE_BEGAN:_b,STATE_CHANGED:ac,STATE_ENDED:bc,STATE_RECOGNIZED:cc,STATE_CANCELLED:dc,STATE_FAILED:ec,DIRECTION_NONE:zb,DIRECTION_LEFT:Ab,DIRECTION_RIGHT:Bb,DIRECTION_UP:Cb,DIRECTION_DOWN:Db,DIRECTION_HORIZONTAL:Eb,DIRECTION_VERTICAL:Fb,DIRECTION_ALL:Gb,Manager:cb,Input:x,TouchAction:Q,Recognizer:S,AttrRecognizer:W,Tap:ab,Pan:X,Swipe:_,Pinch:Y,Rotate:$,Press:Z,on:n,off:o,each:g,merge:i,extend:h,inherit:j,bindFn:k,prefixed:v}),typeof define==hb&&define.amd?define(function(){return bb}):"undefined"!=typeof module&&module.exports?module.exports=bb:a[c]=bb}(window,document,"Hammer");jQuery(document).ajaxSend(function(event,xhr,settings){function getCookie(name){var cookieValue=null;if(document.cookie&&document.cookie!=''){var cookies=document.cookie.split(';');for(var i=0;i<cookies.length;i++){var cookie=jQuery.trim(cookies[i]);if(cookie.substring(0,name.length+1)==(name+'=')){cookieValue=decodeURIComponent(cookie.substring(name.length+1));break;}}}
return cookieValue;}
function sameOrigin(url){var host=document.location.host;var protocol=document.location.protocol;var sr_origin='//'+host;var origin=protocol+sr_origin;return(url==origin||url.slice(0,origin.length+1)==origin+'/')||(url==sr_origin||url.slice(0,sr_origin.length+1)==sr_origin+'/')||!(/^(\/\/|http:|https:).*/.test(url));}
function safeMethod(method){return(/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));}
if(!safeMethod(settings.type)){var token=getCookie('staging-csrftoken')||getCookie('csrftoken');xhr.setRequestHeader("X-CSRFToken",token);}});(function($,window,document,undefined){var $window=$(window);$.fn.lazyload=function(options){var elements=this;var $container;var settings={threshold:0,failure_limit:0,event:"scroll",effect:"show",container:window,data_attribute:"original",skip_invisible:true,appear:null,load:null,placeholder:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC"};function update(){var counter=0;elements.each(function(){var $this=$(this);if(settings.skip_invisible&&!$this.is(":visible")){return;}
if($.abovethetop(this,settings)||$.leftofbegin(this,settings)){}else if(!$.belowthefold(this,settings)&&!$.rightoffold(this,settings)){$this.trigger("appear");counter=0;}else{if(++counter>settings.failure_limit){return false;}}});}
if(options){if(undefined!==options.failurelimit){options.failure_limit=options.failurelimit;delete options.failurelimit;}
if(undefined!==options.effectspeed){options.effect_speed=options.effectspeed;delete options.effectspeed;}
$.extend(settings,options);}
$container=(settings.container===undefined||settings.container===window)?$window:$(settings.container);if(0===settings.event.indexOf("scroll")){$container.bind(settings.event,function(){return update();});}
this.each(function(){var self=this;var $self=$(self);self.loaded=false;if($self.attr("src")===undefined||$self.attr("src")===false){if($self.is("img")){$self.attr("src",settings.placeholder);}}
$self.one("appear",function(){if(!this.loaded){if(settings.appear){var elements_left=elements.length;settings.appear.call(self,elements_left,settings);}
$("<img />").bind("load",function(){var original=$self.attr("data-"+settings.data_attribute);$self.hide();if($self.is("img")){$self.attr("src",original);}else{$self.css("background-image","url('"+original+"')");}
$self[settings.effect](settings.effect_speed);self.loaded=true;var temp=$.grep(elements,function(element){return!element.loaded;});elements=$(temp);if(settings.load){var elements_left=elements.length;settings.load.call(self,elements_left,settings);}}).attr("src",$self.attr("data-"+settings.data_attribute));}});if(0!==settings.event.indexOf("scroll")){$self.bind(settings.event,function(){if(!self.loaded){$self.trigger("appear");}});}});$window.bind("resize",function(){update();});if((/(?:iphone|ipod|ipad).*os 5/gi).test(navigator.appVersion)){$window.bind("pageshow",function(event){if(event.originalEvent&&event.originalEvent.persisted){elements.each(function(){$(this).trigger("appear");});}});}
$(document).ready(function(){update();});return this;};$.belowthefold=function(element,settings){var fold;if(settings.container===undefined||settings.container===window){fold=(window.innerHeight?window.innerHeight:$window.height())+$window.scrollTop();}else{fold=$(settings.container).offset().top+$(settings.container).height();}
return fold<=$(element).offset().top-settings.threshold;};$.rightoffold=function(element,settings){var fold;if(settings.container===undefined||settings.container===window){fold=$window.width()+$window.scrollLeft();}else{fold=$(settings.container).offset().left+$(settings.container).width();}
return fold<=$(element).offset().left-settings.threshold;};$.abovethetop=function(element,settings){var fold;if(settings.container===undefined||settings.container===window){fold=$window.scrollTop();}else{fold=$(settings.container).offset().top;}
return fold>=$(element).offset().top+settings.threshold+$(element).height();};$.leftofbegin=function(element,settings){var fold;if(settings.container===undefined||settings.container===window){fold=$window.scrollLeft();}else{fold=$(settings.container).offset().left;}
return fold>=$(element).offset().left+settings.threshold+$(element).width();};$.inviewport=function(element,settings){return!$.rightoffold(element,settings)&&!$.leftofbegin(element,settings)&&!$.belowthefold(element,settings)&&!$.abovethetop(element,settings);};$.extend($.expr[":"],{"below-the-fold":function(a){return $.belowthefold(a,{threshold:0});},"above-the-top":function(a){return!$.belowthefold(a,{threshold:0});},"right-of-screen":function(a){return $.rightoffold(a,{threshold:0});},"left-of-screen":function(a){return!$.rightoffold(a,{threshold:0});},"in-viewport":function(a){return $.inviewport(a,{threshold:0});},"above-the-fold":function(a){return!$.belowthefold(a,{threshold:0});},"right-of-fold":function(a){return $.rightoffold(a,{threshold:0});},"left-of-fold":function(a){return!$.rightoffold(a,{threshold:0});}});})(jQuery,window,document);var isMobile={Android:function(){return navigator.userAgent.match(/Android/i);},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i);},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i);},Opera:function(){return navigator.userAgent.match(/Opera Mini/i);},Windows:function(){return navigator.userAgent.match(/IEMobile/i);},any:function(){return(isMobile.Android()||isMobile.BlackBerry()||isMobile.iOS()||isMobile.Opera()||isMobile.Windows());}};if(isMobile.iOS==true){$('input').on({'focus':function(){$('nav').addClass('unfix');$('.mobile-nav-dropdown').hide();},'blur':function(){$('nav').removeClass('unfix');$('.mobile-nav-dropdown').show();}});}
$('*').click(function(e){e.stopPropagation();var popover=$(this).siblings('.popover'),mobilePopover=$(this).siblings('.mobile-popover'),hasPopover=popover.length>0,hasMobilePopover=mobilePopover.length>0,isPopover=$(this).hasClass('popover'),openPopovers=$('.popover.show'),isSelectOption=$(this).hasClass('select-option'),areOpenPopovers=openPopovers.length>0;if(hasMobilePopover&&isMobile.any()){mobilePopover.show();setTimeout(function(){mobilePopover.addClass('show');},100);$('.mobile-popover').on('touchmove',function(e){e.preventDefault();});$($('.mobile-share-cancel').parent(),'.mobile-share-cancel').on('touchend',function(e){e.stopPropagation();mobilePopover.removeClass('show');setTimeout(function(){mobilePopover.hide();},300);});return false;}
if(hasPopover&&areOpenPopovers){openPopovers.removeClass('show');}
if(hasPopover){var totalDuration=$('.popover a').css('animation-duration'),totalDuration=totalDuration.substring(0,totalDuration.length-1),popoverItems=popover.children('a'),delayIncr=totalDuration/popoverItems.length;for(var i=0;i<popoverItems.length;i++){$(popoverItems[i]).css('animation-delay',delayIncr*i+'s');}
popover.toggleClass('show');}else if(isPopover){return false;}else if(isSelectOption){setTimeout(function(){openPopovers.removeClass('show');},200);}else{openPopovers.removeClass('show');}});$('*').on('touchend',function(){console.log($(this));});$(window).on('load resize',function(){if($('body.collection').length>0){var collectionTitle=$('.collection-title img'),titleSize={'height':0,'width':0},originalImage=new Image();originalImage.src=$(collectionTitle).attr('src'),originalImage.onload=function(){titleSize.height=originalImage.height;titleSize.width=originalImage.width;$(window).trigger('titleImageSet');}
$(window).on('titleImageSet',function(){if($(window).width()>767){collectionTitle.width(titleSize.width/2);collectionTitle.height(titleSize.height/2);collectionTitle.show().addClass('show');}else{$('.collections .collection').removeAttr('style');if(titleSize.height>$('.collection-title')){collectionTitle.css({'height':'90%','width':''});collectionTitle.addClass('show');}else{collectionTitle.css({'width':'90%','height':''});collectionTitle.addClass('show');}}});}else{return false;}});$('.select-option').not('.inactive').click(function(e){e.preventDefault();var optionValue=$(this).data('value');$(this).parents('.popover').siblings('select').val(optionValue);});var visible=false,showMobileNav=function(){var $this=$(this),theNavItems=$('.mobile-nav-dropdown').find('li');$('.nav-dropdown-arrow').toggleClass('rotate');if(!visible){var i=0;var toggle=setInterval(function(){$(theNavItems[i]).css('top',(i*70));if(i==theNavItems.length-1){clearInterval(toggle);}else{i++}},100);visible=true;}else{var i=theNavItems.length
var toggle=setInterval(function(){$(theNavItems[i]).css('top',-75);if(i==0){clearInterval(toggle);}else{i--}},100);visible=false;}}
$('.need-logo, .nav-dropdown-arrow').on('click',showMobileNav);$('.footer-about,.footer-about img').click(function(){$this_li=$('.footer-about');if($('.expand-icon').is(":visible")){$('.footer-about-link').slideToggle(400);$('.expand-icon',$this_li).toggleClass('expand');}});$('.footer-my-account, .footer-my-account img').click(function(){$this_li=$('.footer-my-account');if($('.expand-icon').is(":visible")){$('.footer-account-link').slideToggle(400);$('.expand-icon',$this_li).toggleClass('expand');}});var numOfProducts=$('.product-grid li').length,productGridWidth=$('.product-grid').width();if(productGridWidth<580){var width=(productGridWidth/3);$('.product-grid li').css('width',width);if(width<116){$('.product-grid li').css('height',width);}}else if(numOfProducts%5==0||Math.round((((numOfProducts/5)%1)*5))>=3){var lastRow=(numOfProducts%5==0)?5:Math.round((((numOfProducts/5)%1)*5));$('.product-grid li').css('width',(productGridWidth/5));$('.product-grid li:nth-child(5n+5)').css('border-right',0);$('.product-grid li:nth-last-child(-n+'+lastRow+')').css('border-bottom',0);}else if(numOfProducts%4==0||Math.round((((numOfProducts/4)%1)*4))>=2){var lastRow=(numOfProducts%4==0)?4:Math.round((((numOfProducts/4)%1)*4));$('.product-grid li').css('width',(productGridWidth/4));$('.product-grid li:nth-child(4n+4)').css('border-right',0);$('.product-grid li:nth-last-child(-n+'+lastRow+')').css('border-bottom',0);}else{var lastRow=(numOfProducts%3==0)?3:Math.round(((numOfProducts/3)%1)*3);$('.product-grid li').css('width',(productGridWidth/3));$('.product-grid li:nth-child(3n+3)').css('border-right',0);$('.product-grid li:nth-last-child(-n+'+lastRow+')').css('border-bottom',0);}
$('.product-grid img').click(function(e){e.preventDefault();var target=$(this).parents('a').attr('href'),targetLocation=$(target).offset().top,scrollTime=($(this).parents('li').index()+1)*200;$('body').animate({'scrollTop':targetLocation-50},scrollTime);});$('.editor-note p:first-of-type').click(function(){$('.editor-note p').toggleClass('expanded');});$('.custom-select').not('.ng-select').click(function(e){var options=$(this).children('ul');$('.custom-select ul').not(options).removeClass('expand');options.toggleClass('expand');});$('.cart-items .custom-select li').click(function(){var optionValue=$(this).val(),customSelect=$(this).parents('.custom-select'),options=customSelect.find('ul'),correspondingInput=customSelect.find('input');correspondingInput.val(optionValue);setTimeout(function(){options.removeClass('expand');$('.cart-form').submit();});});$('.custom-select input').on('change',function(){$('.cart-form').submit();});var param=function(obj){var query='',name,value,fullSubName,subName,subValue,innerObj,i;for(name in obj){value=obj[name];if(value instanceof Array){for(i=0;i<value.length;++i){subValue=value[i];fullSubName=name+'['+i+']';innerObj={};innerObj[fullSubName]=subValue;query+=param(innerObj)+'&';}}
else if(value instanceof Object){for(subName in value){subValue=value[subName];fullSubName=name+'['+subName+']';innerObj={};innerObj[fullSubName]=subValue;query+=param(innerObj)+'&';}}
else if(value!==undefined&&value!==null)
query+=encodeURIComponent(name)+'='+encodeURIComponent(value)+'&';}
return query.length?query.substr(0,query.length-1):query;};function getCookie(name){var cookieValue=null;if(document.cookie&&document.cookie!=''){var cookies=document.cookie.split(';');for(var i=0;i<cookies.length;i++){var cookie=jQuery.trim(cookies[i]);if(cookie.substring(0,name.length+1)==(name+'=')){cookieValue=decodeURIComponent(cookie.substring(name.length+1));break;}}}
return cookieValue;}
var countries=[{"name":"United States","abbreviation":"US"},{"name":"Canada","abbreviation":"CA"},];var USStates=[{"abbreviation":"AL","name":"AL"},{"abbreviation":"AK","name":"AK"},{"abbreviation":"AZ","name":"AZ"},{"abbreviation":"AR","name":"AR"},{"abbreviation":"CA","name":"CA"},{"abbreviation":"CO","name":"CO"},{"abbreviation":"CT","name":"CT"},{"abbreviation":"DE","name":"DE"},{"abbreviation":"DC","name":"DC"},{"abbreviation":"FL","name":"FL"},{"abbreviation":"GA","name":"GA"},{"abbreviation":"HI","name":"HI"},{"abbreviation":"ID","name":"ID"},{"abbreviation":"IL","name":"IL"},{"abbreviation":"IN","name":"IN"},{"abbreviation":"IA","name":"IA"},{"abbreviation":"KS","name":"KS"},{"abbreviation":"KY","name":"KY"},{"abbreviation":"LA","name":"LA"},{"abbreviation":"ME","name":"ME"},{"abbreviation":"MD","name":"MD"},{"abbreviation":"MA","name":"MA"},{"abbreviation":"MI","name":"MI"},{"abbreviation":"MN","name":"MN"},{"abbreviation":"MS","name":"MS"},{"abbreviation":"MO","name":"MO"},{"abbreviation":"MT","name":"MT"},{"abbreviation":"NE","name":"NE"},{"abbreviation":"NV","name":"NV"},{"abbreviation":"NH","name":"NH"},{"abbreviation":"NJ","name":"NJ"},{"abbreviation":"NM","name":"NM"},{"abbreviation":"NY","name":"NY"},{"abbreviation":"NC","name":"NC"},{"abbreviation":"ND","name":"ND"},{"abbreviation":"OH","name":"OH"},{"abbreviation":"OK","name":"OK"},{"abbreviation":"OR","name":"OR"},{"abbreviation":"PA","name":"PA"},{"abbreviation":"RI","name":"RI"},{"abbreviation":"SC","name":"SC"},{"abbreviation":"SD","name":"SD"},{"abbreviation":"TN","name":"TN"},{"abbreviation":"TX","name":"TX"},{"abbreviation":"UT","name":"UT"},{"abbreviation":"VT","name":"VT"},{"abbreviation":"VA","name":"VA"},{"abbreviation":"WA","name":"WA"},{"abbreviation":"WV","name":"WV"},{"abbreviation":"WI","name":"WI"},{"abbreviation":"WY","name":"WY"}];var CAProvinces=[{"abbreviation":"AB","name":"Alberta"},{"abbreviation":"BC","name":"British Columbia"},{"abbreviation":"MB","name":"Manitoba"},{"abbreviation":"NB","name":"New Brunswick"},{"abbreviation":"NL","name":"Newfoundland and Labrador"},{"abbreviation":"NT","name":"Northwest Territories"},{"abbreviation":"NS","name":"Nova Scotia"},{"abbreviation":"NU","name":"Nunavut"},{"abbreviation":"ON","name":"Ontario"},{"abbreviation":"PE","name":"Prince Edward Island"},{"abbreviation":"QC","name":"Quebec"},{"abbreviation":"SK","name":"Saskatchewan"},{"abbreviation":"YT","name":"Yukon"}];var parseGoogleAddressComponents=function(addressComponents){var address={city:'',state:'',country:'',postalCode:''};for(var i=0;i<addressComponents.length;i++){var part=addressComponents[i];for(var x=0;x<part.types.length;x++){var type=part.types[x];if(type.toLowerCase()==='country'){address.country=part;break;}else if(type.toLowerCase()==='postal_code'){address.postalCode=part;break;}else if(type.toLowerCase()==='locality'){address.city=part;break;}else if(type.toLowerCase()==='administrative_area_level_1'){address.state=part;break;}else if(!address.city){if(type.toLowerCase()==='administrative_area_level_2'||type.toLowerCase()==='administrative_area_level_3'){address.city=part;break;}}}}
return address;};(function(){var lastTime=0;var vendors=['ms','moz','webkit','o'];for(var x=0;x<vendors.length&&!window.requestAnimationFrame;++x){window.requestAnimationFrame=window[vendors[x]+'RequestAnimationFrame'];window.cancelAnimationFrame=window[vendors[x]+'CancelAnimationFrame']||window[vendors[x]+'CancelRequestAnimationFrame'];}
if(!window.requestAnimationFrame)
window.requestAnimationFrame=function(callback,element){var currTime=new Date().getTime();var timeToCall=Math.max(0,16-(currTime-lastTime));var id=window.setTimeout(function(){callback(currTime+timeToCall);},timeToCall);lastTime=currTime+timeToCall;return id;};if(!window.cancelAnimationFrame)
window.cancelAnimationFrame=function(id){clearTimeout(id);};}());(function(){$('.carousel').each(function(){var carousel=$(this),carouselWidth=carousel.width(),imageContainer=carousel.find('.image-container'),images=carousel.find('img'),numberOfImages=images.length,areMultipleImages=numberOfImages>1,currentImageNumber=1,advanceDistance=carouselWidth,endOfCarousel=numberOfImages,beginningOfCarousel=1,nav=carousel.find('.carousel-nav ul'),navCircles=nav.find('li');function updateNav(){navCircles=nav.find('li');activeNavCircle=currentImageNumber-1;navCircles.removeClass('active');$(navCircles[activeNavCircle]).addClass('active');}
$(window).on('load',function(){images.width(carouselWidth);imageContainer.width(carouselWidth*numberOfImages);if(areMultipleImages){for(var i=0;i<images.length;i++){nav.append('<li class="circle"></li>');}
updateNav();}});function moveCarousel(direction){if(!direction){if(currentImageNumber!=endOfCarousel){imageContainer.addClass('animate');imageContainer.css('transform','translate3d('+(advanceDistance*currentImageNumber*-1)+'px,0,0)');currentImageNumber++;updateNav();}else{imageContainer.css('transform','translate3d(0,0,0)');currentImageNumber=1;updateNav();}}else if(direction=='forward'){if(currentImageNumber!=endOfCarousel){imageContainer.addClass('animate');imageContainer.css('transform','translate3d('+(advanceDistance*currentImageNumber*-1)+'px,0,0)');currentImageNumber++;updateNav();}else{return false;}}else if(direction=='back'){if(currentImageNumber!=beginningOfCarousel){currentImageNumber--;imageContainer.addClass('animate');imageContainer.css('transform','translate3d('+(advanceDistance*(currentImageNumber-1)*-1)+'px,0,0)');updateNav();}else{return false;}}}
images.click(function(e){e.stopPropagation();requestAnimationFrame(moveCarousel());});navCircles.click(function(e){e.stopPropagation();var navCircleNumber=$(this).index();currentImageNumber=navCircleNumber;requestAnimationFrame(moveCarousel());updateNav();});var swipeImageContainer=new Hammer(this);swipeImageContainer.get('pan').set({threshold:0,pointers:0,});swipeImageContainer.on('panleft',function(e){if(currentImageNumber!=endOfCarousel&&Math.abs(e.deltaY)<150){imageContainer.removeClass('animate');imageContainer.css('transform','translate3d('+((advanceDistance*(currentImageNumber-1)*-1)+e.deltaX)+'px,0,0) scale3d(1,1,1)');}});swipeImageContainer.on('panright',function(e){if(currentImageNumber!=beginningOfCarousel&&Math.abs(e.deltaY)<150){imageContainer.removeClass('animate');imageContainer.css('transform','translate3d('+((advanceDistance*(currentImageNumber-1)*-1)+e.deltaX)+'px,0,0) scale3d(1,1,1)');}});swipeImageContainer.on('panend pancancel',function(ev){if(ev.deltaX<0){if(currentImageNumber!=endOfCarousel){if(Math.abs(ev.deltaX)<advanceDistance/3){imageContainer.addClass('animate');imageContainer.css('transform','translate3d('+(advanceDistance*(currentImageNumber-1)*-1)+'px,0,0) scale3d(1,1,1)');}else{moveCarousel('forward');}}}else if(ev.deltaX>0){if(currentImageNumber!=beginningOfCarousel){if(Math.abs(ev.deltaX)<advanceDistance/2.5){imageContainer.addClass('animate');imageContainer.css('transform','translate3d('+(advanceDistance*(currentImageNumber-1)*-1)+'px,0,0) scale3d(1,1,1)');}else{moveCarousel('back');}}}});function resizeMe(){carouselWidth=carousel.width();images.width(carouselWidth);advanceDistance=carouselWidth;imageContainer.width(carouselWidth*numberOfImages);imageContainer.css('transform','translate3d('+(advanceDistance*(currentImageNumber-1)*-1)+'px,0,0)');};$(window).on('resize orientationchange',resizeMe);});})();$.rightoffold=function(element,settings){return false;};$(".carousel img.lazy").lazyload({threshold:200,placeholder:'',});$(".modal_window_designer img.lazy").lazyload({skip_invisible:false});var ShoppingCart=function(data){'use strict';var self=this;data=typeof data!=='undefined'?data:{};self.cartUrl=data.cartUrl;self.cartItemCount=data.cartItemCount||0;self.addItemToCart=function(itemSize,count){var count=(typeof(count)=="undefined")?1:count;return $.ajax({url:self.cartUrl,type:'POST',dataType:'json',cache:false,data:{item:itemSize,count:count},xhrFields:{withCredentials:true,},});}
self.getCartTotal=function(){return $.ajax({url:self.cartUrl,type:'GET',dataType:'json',cache:false,xhrFields:{withCredentials:true,},});}}
var ShippingAddress=function(data){"use strict";data=typeof data!=='undefined'?data:{};var self=this;this.addressLine1=data.address_line_1||'';this.addressLine2=data.address_line_2||'';this.city=data.city||'';this.country=data.country||'';this.state=data.state||'';this.zipCode=data.zip_code||'';this.phoneNumber=data.phone_number||'';this.fullName=data.full_name||'';this.id=data.id||null;this.url=data.url||'';this.formErrors={};this.hasFormErrors=false;if(!this.url){var urlString='/api/accounts/shipping_address/';if(self.id){urlString+=self.id+'/';}
this.url=urlString;}
this.clearFormErrors=function(){self.formErrors={};self.hasFormErrors=false;};this.validateAddress=function(){var data={address_line_1:self.addressLine1,address_line_2:self.addressLine2,city:self.city,state:self.state,zip_code:self.zipCode,phone_number:self.phoneNumber,full_name:self.fullName,country:self.country,};return $.ajax({url:'/api/accounts/address/validate/',type:'POST',data:data});};this._buildSaveData=function(){return{address_line_1:self.addressLine1,address_line_2:self.addressLine2,city:self.city,state:self.state,zip_code:self.zipCode,phone_number:self.phoneNumber,full_name:self.fullName,country:self.country,id:self.id,};};this.create=function(){var postData=self._buildSaveData();return $.ajax({url:self.url,type:'POST',data:postData,dataType:'json',});};this.update=function(){var postData=self._buildSaveData();return $.ajax({url:self.url,type:'PUT',data:postData,dataType:'json',});};};angular.module('DeleteAccount',[]).controller('DeleteAccountCtrl',['$http',function($http){var self=this;this.error=false;this.deleteAccount=function(){$http.delete('/api/accounts/my_account/').success(function(){window.location='/';}).error(function(){self.error=true;});};}]);angular.module('RegisterModule',[]).controller('RegisterController',['$scope','$http',function($scope,$http){"use strict";var self=this;this.email='';this.activation_key=''
this.errorMessage='';this.success=false;this.successEmail='';this.processForm=function(){var params={'email':self.email};$http.post(USER_REG,params,{headers:{'Content-Type':'application/x-www-form-urlencoded'}}).success(function(data,status,headers,config){console.log(data);if(data){if(data.errors){self.errorMessage=data.errors.email[0];}
if(data.activation_key){self.activation_key=data.activation_key;self.success=true;self.errorMessage='';self.successEmail=self.email;self.email='';}}}).error(function(data,status,headers,config){console.log(data);});};this.resend=function(){var params={'email':self.successEmail};$http.post(USER_REG,params,{headers:{'Content-Type':'application/x-www-form-urlencoded'}}).success(function(data,status,headers,config){console.log(data);if(data){if(data.errors){self.errorMessage=data.errors.email[0];}
if(data.activation_key){self.activation_key=data.activation_key;self.success=true;self.errorMessage='';self.successEmail=self.email;}}});};}]);angular.module('registerApp',['RegisterModule',]).config(['$httpProvider','$interpolateProvider',function($httpProvider,$interpolateProvider){var token=getCookie('staging-csrftoken')?'staging-csrftoken':'csrftoken';$httpProvider.defaults.xsrfCookieName=token;$httpProvider.defaults.xsrfHeaderName='X-CSRFToken';$httpProvider.defaults.withCredentials=true;$httpProvider.defaults.headers.post={'Content-Type':'application/x-www-form-urlencoded'};$httpProvider.defaults.headers.common["X-Requested-With"]='XMLHttpRequest';$httpProvider.defaults.transformRequest=[function(data){return angular.isObject(data)&&String(data)!=='[object File]'?param(data):data;}];$interpolateProvider.startSymbol('[[');$interpolateProvider.endSymbol(']]');}]);angular.module('CartModule',[]).controller('CartCtrl',['$scope','Cart',function($scope,Cart){var self=this;this.addToCartError='';$scope.shoppingCart=Cart.shoppingCart;self.addToCart=function(event){var $clicked=$(event.currentTarget),cartContainer=$clicked.parents('.cart'),addToCartIcon=cartContainer.children('.add-to-cart'),spinner=cartContainer.children('.cart-spinner'),confirmation=cartContainer.children('.confirm-cart-check'),correspondingSelect=cartContainer.children('select'),itemSize=correspondingSelect.val(),selectedSize='';if(itemSize==='Select Size'){itemSize=correspondingSelect.children("option:eq(1)").attr('value')}
addToCartIcon.addClass('hide');$scope.count=10000000;setTimeout(function(){spinner.addClass('show')
setTimeout
shoppingCart.addItemToCart(itemSize).done(function(data){$('.mobile-size-select').val('Select Size');$('.cart-nav').addClass('show-message');setTimeout(function(){$scope.$apply(function(){Cart.shoppingCart.cartItemCount=data.shopping_cart.total_items;});},400);spinner.removeClass('show');setTimeout(function(){confirmation.addClass('show');setTimeout(function(){confirmation.removeClass('show');setTimeout(function(){addToCartIcon.removeClass('hide');$('.cart-nav').removeClass('show-message');},400)},400)},400);}).error(function(data){$scope.$apply(function(){self.addToCartError='There was an error adding this item to the cart. Try again or contact Need Support';console.log(self.addToCartError);});spinner.removeClass('show');setTimeout(function(){addToCartIcon.removeClass('hide');},400);});},400);}}]);angular.module('CartTaxEstimateModule',[]).controller('TaxEstimateCtrl',['$scope','$http',function($scope,$http){"use strict";var self=this;this.geoCoder=new google.maps.Geocoder();this.postalCode='';this.shippingCost='';this.tax='';this.subtotal=$('#subtotal-price').data('subtotal');this.total=$('#total-price').data('total');this.working=false;$scope.lookupPostalCode=function(){if(!self.postalCode){return;}
self.working=true;self.geoCoder.geocode({'address':self.postalCode},function(results,status){if(status==google.maps.GeocoderStatus.OK){var address=parseGoogleAddressComponents(results[0].address_components);var params={zip_code:self.postalCode,city:address.city.short_name,state:address.state.short_name};$http.post('/api/shopping_cart/estimate_costs/',params).success(function(data,status,headers,config){self.shippingCost=data.shipping;self.tax=data.sales_tax;self.subtotal=data.subtotal;var tempTotal=parseFloat(data.shipping)+parseFloat(data.sales_tax)+parseFloat(data.subtotal);self.total=tempTotal.toFixed(2);self.working=false;}).error(function(data,status,headers,config){console.log(data);self.working=false;});}else{console.log("Geocode was not successful for the following reason: "+status);self.working=false;}});};}]);angular.module('SelectShippingAddress',[]).controller('SelectAddressCtrl',['$scope','$http',function($scope,$http){var self=this;this.geoCoder=new google.maps.Geocoder();this.usStates=USStates;this.caProvinces=CAProvinces;this.countries=countries;this.selectedState='Select';this.selectedCountry='Select';this.addresses=addressModels;this.editingAddressIndex=null;this.editingAddressOriginal=new ShippingAddress();this.selectedAddress=null;this.addingAddress=false;this.newAddress=new ShippingAddress({country:'Select',state:'Select'});this.saveNewAddress=true;this.lookupPostalCode=_.debounce(function(address){if(!address.zipCode){return;}
address.clearFormErrors();self.geoCoder.geocode({'address':address.zipCode},function(results,status){if(status==google.maps.GeocoderStatus.OK){var googleAddress=parseGoogleAddressComponents(results[0].address_components);$scope.$apply(function(){address.city=googleAddress.city.short_name;address.state=googleAddress.state.short_name;address.country=googleAddress.country.short_name;});}else{console.log("Geocode was not successful for the following reason: "+status);}});},250);this.customSelectClick=function(e){var options=$(e.target).children('ul');$('.custom-select ul').not(options).removeClass('expand');options.toggleClass('expand');};this.selectAddress=function(){self.addingAddress=false;this.newAddress=new ShippingAddress({country:'Select',state:'Select'});if(self.editingAddressIndex||self.editingAddressIndex===0){self.cancelEditingAddress(self.addresses[self.editingAddressIndex]);}};this.toggleAddingAddress=function(){self.addingAddress=!self.addingAddress;if(!self.addingAddress){self.newAddress=new ShippingAddress({country:'Select',state:'Select'});}else{if(self.editingAddressIndex||self.editingAddressIndex===0){self.cancelEditingAddress(self.addresses[self.editingAddressIndex]);}
self.selectedAddress=null;}};this.copyAddressProperties=function(source,dest){if(source&&dest){dest.fullName=source.fullName;dest.addressLine1=source.addressLine1;dest.address_line_2=source.addressLine2;dest.zipCode=source.zipCode;dest.city=source.city;dest.state=source.state;}};this.setEditingAddress=function(index){self.addresses[index].clearFormErrors();if(index!==self.editingAddressIndex){if(self.editingAddressIndex!==null){self.copyAddressProperties(self.editingAddressOriginal,self.addresses[self.editingAddressIndex]);}
self.editingAddressIndex=index;self.copyAddressProperties(self.addresses[index],self.editingAddressOriginal);self.addingAddress=false;}
self.newAddress.clearFormErrors();};this.cancelEditingAddress=function(address){self.editingAddressIndex=null;self.copyAddressProperties(self.editingAddressOriginal,address);self.editingAddressOriginal=new ShippingAddress({country:'Select',state:'Select'});address.clearFormErrors();};this.updateAddress=function(address){address.clearFormErrors();if(address.country&&address.country.toUpperCase().trim()==='US'){address.validateAddress().done(function(data){$scope.$apply(function(){address.addressLine1=data.objects.address_line_1;address.addressLine2=data.objects.address_line_2;address.city=data.objects.city;address.state=data.objects.state;address.country=data.objects.country;address.zipCode=data.objects.zip_code;});if(address.id){self._updateAddressAndCleanup(address);}else{self._cleanupUpdateAddress();}}).fail(function(data){$scope.$apply(function(){var response_json=data.responseJSON;angular.forEach(response_json,function(value,key){address.formErrors[key]=value;address.hasFormErrors=true;});});});;}else{if(address.id){this._updateAddressAndCleanup(address);}else{self._cleanupUpdateAddress();}}};this._updateAddressAndCleanup=function(address){address.update().done(function(data){$scope.$apply(function(){self._cleanupUpdateAddress();});}).fail(function(data){$scope.$apply(function(){var response_json=data.responseJSON;angular.forEach(response_json,function(value,key){address.formErrors[key]=value;address.hasFormErrors=true;});});});};this._cleanupUpdateAddress=function(){self.editingAddressOriginal=new ShippingAddress({country:'Select',state:'Select'});self.editingAddressIndex=null;}
this.isAddressUsable=function(address){return address.addressLine1&&address.city&&address.state&&address.zipCode&&address.country&&address.phoneNumber;};this.setAddressAndContinue=function(address){address.clearFormErrors();if(address.country&&address.country.toUpperCase().trim()==='US'){address.validateAddress().done(function(data){$scope.$apply(function(){address.addressLine1=data.objects.address_line_1;address.addressLine2=data.objects.address_line_2;address.city=data.objects.city;address.state=data.objects.state;address.country=data.objects.country;address.zipCode=data.objects.zip_code;self.addresses.push(address);self.selectedAddress=address;});if(self.saveNewAddress){address.create().done(function(data){self.saveAddressToOrder();});}else{self.saveAddressToOrder();}}).fail(function(data){$scope.$apply(function(){var response_json=data.responseJSON;angular.forEach(response_json,function(value,key){address.formErrors[key]=value;address.hasFormErrors=true;});});});}else{self.selectedAddress=address;if(self.saveNewAddress){address.create().done(function(data){self.saveAddressToOrder();}).fail(function(data){$scope.$apply(function(){var response_json=data.responseJSON;angular.forEach(response_json,function(value,key){address.formErrors[key]=value;address.hasFormErrors=true;});});});}else{self.saveAddressToOrder();}}};this.useNewAddress=function(address){address.clearFormErrors();if(address.country&&address.country.toUpperCase().trim()==='US'){address.validateAddress().done(function(data){$scope.$apply(function(){address.addressLine1=data.objects.address_line_1;address.addressLine2=data.objects.address_line_2;address.city=data.objects.city;address.state=data.objects.state;address.country=data.objects.country;address.zipCode=data.objects.zip_code;self.addresses.push(address);self.selectedAddress=address;});if(self.saveNewAddress){address.create().done(function(data){$scope.$apply(function(){address.id=data.id;address.url=data.url;self.toggleAddingAddress();});});}else{$scope.$apply(function(){self.toggleAddingAddress();});}}).fail(function(data){$scope.$apply(function(){var response_json=data.responseJSON;angular.forEach(response_json,function(value,key){address.formErrors[key]=value;address.hasFormErrors=true;});});});}else{self.addresses.push(address)
self.selectedAddress=address;if(self.saveNewAddress){address.create().done(function(data){$scope.$apply(function(){address.id=data.id;address.url=data.url;self.toggleAddingAddress();});}).fail(function(data){$scope.$apply(function(){var response_json=data.responseJSON;angular.forEach(response_json,function(value,key){address.formErrors[key]=value;address.hasFormErrors=true;});});});}else{address.clearFormErrors();self.toggleAddingAddress();}}};this.saveAddressToOrder=function(){var address=self.selectedAddress;$http.post('/api/checkout/set_shipping_address/',address._buildSaveData()).success(function(){window.location='/checkout/select_billing/';}).error(function(data){});};this.selectState=function(event,state,address){var $clicked=$(event.currentTarget);$clicked.parents('ul').removeClass('expand');address.state=state;};this.selectCountry=function(event,country,address){var $clicked=$(event.currentTarget);$clicked.parents('ul').removeClass('expand');address.country=country;};this.countryChanged=function(address){address.state='Select';};}]);var myAccountAddresses=angular.module('AccountManageAddresses',['ngAnimate']);myAccountAddresses.controller('ManageAddressCtl',['$scope','$http',function($scope,$http){"use strict";var self=this;this.geoCoder=new google.maps.Geocoder();this.usStates=USStates;this.caProvinces=CAProvinces;this.countries=countries;this.addresses=addressModels;this.editingAddressIndex=null;this.editingAddressOriginal=new ShippingAddress();this.addingAddress=false;this.newAddress=new ShippingAddress({country:'Select',state:'Select'});this.lookupPostalCode=_.debounce(function(address){if(!address.zipCode){return;}
address.clearFormErrors();self.geoCoder.geocode({'address':address.zipCode},function(results,status){if(status==google.maps.GeocoderStatus.OK){var googleAddress=parseGoogleAddressComponents(results[0].address_components);$scope.$apply(function(){address.city=googleAddress.city.short_name;address.state=googleAddress.state.short_name;address.country=googleAddress.country.short_name;});}else{console.log("Geocode was not successful for the following reason: "+status);}});},250);this.deleteAddress=function(index){var address=self.addresses[index];$http.delete(address.url).success(function(){self.addresses.splice(index,1);}).error(function(data){console.log('Error removing address');});};this.copyAddressProperties=function(source,dest){if(source&&dest){dest.fullName=source.fullName;dest.addressLine1=source.addressLine1;dest.address_line_2=source.addressLine2;dest.zipCode=source.zipCode;dest.city=source.city;dest.state=source.state;}};this.setEditingAddressIndex=function(index){if(index===self.editingAddressIndex){self.copyAddressProperties(self.editingAddressOriginal,self.addresses[index]);self.editingAddressIndex=null;self.addresses[index].clearFormErrors();}else{if(self.editingAddressIndex!==null){self.copyAddressProperties(self.editingAddressOriginal,self.addresses[self.editingAddressIndex]);self.addresses[self.editingAddressIndex].clearFormErrors();}
self.editingAddressIndex=index;self.copyAddressProperties(self.addresses[index],self.editingAddressOriginal);self.addingAddress=false;self.newAddress=new ShippingAddress({country:'Select',state:'Select'});}};this.saveAddress=function(address,isNew){address.clearFormErrors();if(address.country&&address.country.toUpperCase().trim()==='US'){address.validateAddress().done(function(data){$scope.$apply(function(){address.addressLine1=data.objects.address_line_1;address.addressLine2=data.objects.address_line_2;address.city=data.objects.city;address.state=data.objects.state;address.country=data.objects.country;address.zipCode=data.objects.zip_code;});if(!isNew){self._updateAddressAndCleanup(address);}else{self._createAddressAndCleanup(address);}}).fail(function(data){$scope.$apply(function(){var response_json=data.responseJSON;angular.forEach(response_json,function(value,key){address.formErrors[key]=value;address.hasFormErrors=true;});});});}else{if(!isNew){self._updateAddressAndCleanup(address);}else{self._createAddressAndCleanup(address);}}};this._createAddressAndCleanup=function(address){address.create().done(function(data){$scope.$apply(function(){address.id=data.id;address.url=data.url;self.addresses.push(address);self.toggleAddingAddress();});}).fail(function(data){$scope.$apply(function(){var response_json=data.responseJSON;angular.forEach(response_json,function(value,key){address.formErrors[key]=value;address.hasFormErrors=true;});});});;};this._updateAddressAndCleanup=function(address){address.update().done(function(data){$scope.$apply(function(){if(self.editingAddressIndex||self.editingAddressIndex===0){self.editingAddressIndex=null;self.editingAddressOriginal=new ShippingAddress();}});}).fail(function(data){$scope.$apply(function(){var response_json=data.responseJSON;angular.forEach(response_json,function(value,key){address.formErrors[key]=value;address.hasFormErrors=true;});});});};this.toggleAddingAddress=function(){this.addingAddress=!this.addingAddress;if(!this.addingAddress){this.newAddress=new ShippingAddress({country:'Select',state:'Select'});}else{if(self.editingAddressIndex||self.editingAddressIndex===0){var selectedAddress=self.addresses[self.editingAddressIndex];self.setEditingAddressIndex(self.editingAddressIndex);selectedAddress.clearFormErrors();}}};this.customSelectClick=function(e){var options=$(e.target).children('ul');$('.custom-select ul').not(options).removeClass('expand');options.toggleClass('expand');};this.selectState=function(event,state,address){var $clicked=$(event.currentTarget);$clicked.parents('ul').removeClass('expand');address.state=state;};this.selectCountry=function(event,country,address){var $clicked=$(event.currentTarget);$clicked.parents('ul').removeClass('expand');address.country=country;};this.countryChanged=function(address){address.state='Select';};}]);var myAccountBilling=angular.module('SelectBilling',['ngAnimate']).controller('SelectBillingCtrl',['$scope','$http',function($scope,$http){var self=this;this.bt=braintree;this.creditCards=credit_cards_json;this.newCard={};this.selectedCard=null;this.addingCard=false;this.messages;this.areErrors=false;this.success=false;this.saveAndContinue=function(card){self.createCardOnServer(card).success(function(data,status,headers,config){card=data;self.setCreditCard(card);}).error(function(data,status,headers,config){self.messages='Error adding credit card.';self.error=true;});};this.addNewCard=function(card){self.createCardOnServer(card).success(function(data,status,headers,config){card=data;self.creditCards.push(card);self.selectedCard=card;self.toggleAddingCard();}).error(function(data,status,headers,config){self.messages='Error adding credit card.';self.error=true;});};this.createCardOnServer=function(card){var encrypted=self.bt.encrypt(self.newCard.cc_number);return $http.post('/api/credit_cards/credit_card/',{'postal_code':card.postal_code,'expiration_month':card.expiration_month,'expiration_year':card.expiration_year,'cardholder_name':card.cardholder_name,'cc_number':encrypted,'cvv':card.cvv});};this.setCreditCard=function(card){$http.put('/api/checkout/set_billing/',{'credit_card':card.token}).success(function(data,status,headers,config){window.location='/checkout/review_order/';}).error(function(data,status,headers,config){console.log('Error setting credit card for order');});};this.toggleAddingCard=function(){self.addingCard=!self.addingCard;if(!self.addingCard){this.newCard={};this.messages='';this.areErrors=false;}};}]);angular.module('PasswordResetModule',[]).controller('PasswordResetController',['$scope','$http',function($scope,$http){"use strict";var self=this;this.email='';this.showResetSuccessMessage=false;this.errorMessage='';this.submitForm=function(){$http.post('/api/accounts/password_reset/',{email:self.email}).success(function(data,status,headers,config){self.showResetSuccessMessage=true;self.errorMessage='';}).error(function(data,status,headers,config){if(data.email){self.errorMessage=data.email[0];self.showResetSuccessMessage=false;}});};}]);angular.module('CheckoutReviewModule',[]).controller('CheckoutReviewCtrl',['$scope','$http','$timeout','$window','$document',function($scope,$http,$timeout,$window,$document){var self=this;this.order=order_json;this.spinnerState='';this.completeButtonState='';this.errors='';this.discountCodeSpinner=false;this.discountCode=$('#discount-code').val();this.lookupDiscountCode=function(){self.discountCodeSpinner=true;self.completeButtonState='disable';$timeout(function(){var u=$window.location.host;var u=[$window.location.protocol,'//',$window.location.host,$window.location.pathname].join('');$window.location=u+'?code='+self.discountCode;},500);};this.completeOrder=function(){self.spinnerState='show';self.completeButtonState='disable';$http.post('/checkout/review_order/'+self.order.uuid+'/',{params:{code:self.discountCode}}).success(function(data){if(data.redirect_url){window.location.replace(data.redirect_url);}else if(data.transaction){window.location.replace("/checkout/success/"+data.order.uuid+'/');}else{self.errors='There was a problem processing your request. Please try again or contact Need Support';self.spinnerState='';self.completeButtonState='';}}).error(function(data,status,headers,config){self.errors=data.error;self.spinnerState='';self.completeButtonState='';});};this.cancelOrder=function(){$http.delete('/api/checkout/cancel/'+self.order.uuid+'/').success(function(data,status,headers,config){window.location.replace('/')}).errof(function(data,status,headers,config){console.log(data);window.location.replace('/')});}}]);angular.module('MyAccountCreditCard',[]).controller('MyAccountCreditCardCtrl',['$scope','$http',function($scope,$http){var self=this;this.bt=braintree;this.creditCards=credit_cards_json;this.newCard={};this.addingCard=!(self.creditCards.length);this.addNewCard=function(card){self.createCardOnServer(card).success(function(data,status,headers,config){card=data;self.creditCards.push(card);self.toggleAddingCard();}).error(function(data,status,headers,config){console.log('Error adding credit card.');});};this.createCardOnServer=function(card){var encrypted=self.bt.encrypt(card.cc_number);return $http.post('/api/credit_cards/credit_card/',{'postal_code':card.postal_code,'expiration_month':card.expiration_month,'expiration_year':card.expiration_year,'cardholder_name':card.cardholder_name,'cc_number':encrypted,'cvv':card.cvv});};this.deleteCard=function(card){var index=self.creditCards.indexOf(card);$http.delete('/api/credit_cards/credit_card/'+card.id+'/').success(function(data,status,headers,config){self.creditCards.splice(index,1);}).error(function(data,status,headers,config){console.log('Error removing credit card.');});};this.toggleAddingCard=function(){self.addingCard=!self.addingCard;if(!self.addingCard){self.newCard={};}};}]);angular.module('ReturnRequestModule',[]).controller('ReturnRequestCtrl',['$scope','$http',function($scope,$http){"use strict";var self=this;this.serverError=false;this.formSubmitting=false;this.submitForm=function(e,url){var form=$(e.target);var data=form.serialize();self.serverError=false;self.formSubmitting=true;$http.post(url,data).success(function(data){$('.form-errors').empty()
$('.alert.error').hide();if(data.errors){self.formSubmitting=false;for(var key in data.errors){var itemId=key;var obj=data.errors[itemId];if(obj.count){var searchId='#id_orderitem_'+itemId+"-count_errors";var errorsUL=$(searchId);errorsUL.append('<li>'+obj.count[0]+'</li>')
$('#'+itemId+'_errors').show();}
if(obj.reason){var searchId='#id_orderitem_'+itemId+"-reason_errors";var errorsUL=$(searchId);var errorMessage='<li>'+obj.reason[0]+'</li>';errorsUL.append('<li>'+obj.reason[0]+'</li>');$('#'+itemId+'_errors').show();}}}else{window.location=data.url;}}).error(function(data){self.serverError=true;self.formSubmitting=false;});};this.customSelectClick=function(e){var options=$(e.target).children('ul');$('.custom-select ul').not(options).removeClass('expand');options.toggleClass('expand');};this.selectCount=function(e,selectedValue,targetId,displayTarget){var clicked=$(e.target);var value=selectedValue;var inputElement=$('#'+targetId);var display=$('#'+displayTarget);inputElement.val(value);clicked.parents('ul').removeClass('expand');display.text(value);}
this.selectReason=function(e,displayReason,targetId,displayTarget){var clicked=$(e.target);var value=clicked.attr('value');var inputElement=$('#'+targetId);var display=$('#'+displayTarget);inputElement.val(value);clicked.parents('ul').removeClass('expand');display.text(displayReason);};}]);var needAppModule=angular.module('needApp',['CartModule','CartTaxEstimateModule','SelectShippingAddress','AccountManageAddresses','SelectBilling','MyAccountCreditCard','ngAnimate','PasswordResetModule','CheckoutReviewModule','registerApp','ReturnRequestModule','DeleteAccount','ProSelectBilling']).factory('Cart',function(){var service={};service.shoppingCart=shoppingCart;return service;}).config(['$httpProvider','$interpolateProvider',function($httpProvider,$interpolateProvider){var token=getCookie('staging-csrftoken')?'staging-csrftoken':'csrftoken';$httpProvider.defaults.xsrfCookieName=token;$httpProvider.defaults.xsrfHeaderName='X-CSRFToken';$httpProvider.defaults.withCredentials=true;$httpProvider.defaults.headers.post={'Content-Type':'application/x-www-form-urlencoded'};$httpProvider.defaults.headers.put={'Content-Type':'application/x-www-form-urlencoded'};$httpProvider.defaults.headers.common["X-Requested-With"]='XMLHttpRequest';$httpProvider.defaults.transformRequest=[function(data){return angular.isObject(data)&&String(data)!=='[object File]'?param(data):data;}];$interpolateProvider.startSymbol('[[');$interpolateProvider.endSymbol(']]');}]);$(window).scroll(function(e){if($(window).scrollTop()+$('nav').height()>=$('.volume-bar').offset().top+($('.volume-bar').height()-$('.stripe').height())){$('.stripe').addClass('fix');}else{$('.stripe').removeClass('fix');}});$(window).on('load resize',function(){var sections=$('section'),increment=$(window).width()/sections.length,sectionBreakpoints=[];$('.loc-indicator').width(increment);$(window).scroll(function(e){var scrollTop=$(window).scrollTop();$('section').each(function(index){if(scrollTop>$(this).offset().top-300&&scrollTop<$(this).offset().top+$(this).height()/2){$('.loc-indicator').css('left',increment*index);}});});});angular.module('ProSelectBilling',[]);angular.module('ProSelectBilling').controller('ProSelectBillingCtrl',['$scope','$http',function($scope,$http){var self=this;this.bt=braintree;this.creditCards=credit_cards_json;this.newCard={};this.selectedCardToken=null;this.addingCard=!!(this.creditCards.length<1);this.messages;this.areErrors=false;this.success=false;this.selectedCard=this.addingCard?this.newCard:null;this.saveAndContinue=function(card){if(card.token){self.setCreditCard(card);}else{self.createCardOnServer(card).success(function(data,status,headers,config){self.setCreditCard(data);}).error(function(data,status,headers,config){self.messages='Error adding credit card.';self.error=true;});}};this.createCardOnServer=function(card){var encrypted=self.bt.encrypt(card.cc_number);return $http.post('/api/credit_cards/credit_card/',{'postal_code':card.postal_code,'expiration_month':card.expiration_month,'expiration_year':card.expiration_year,'cardholder_name':card.cardholder_name,'cc_number':encrypted,'cvv':card.cvv});};this.setCreditCard=function(card){self.selectedCardToken=card.token;document.getElementById("token").value=self.selectedCardToken;document.getElementById('complete_signup').submit();};this.toggleAddingCard=function(){self.addingCard=!self.addingCard;if(!self.addingCard){this.newCard={};this.messages='';this.areErrors=false;this.selectedCard={};}else{this.selectedCard=this.newCard;}};this.stopAddingCard=function(){self.addingCard=false;this.newCard={};this.messages='';this.areErrors=false;this.selectedCard={};};}]);angular.module('ProSelectBilling').controller('ProUpdateBillingCtrl',['$scope','$http',function($scope,$http){var self=this;this.bt=braintree;this.creditCards=credit_cards_json;this.newCard={};this.selectedCardToken=null;this.addingCard=!!(this.creditCards.length<1);this.messages;this.areErrors=false;this.success=false;this.selectedCard=this.addingCard?this.newCard:null;this.subscription=subscription_json;angular.forEach(self.creditCards,function(value,key){if(self.subscription&&self.subscription.credit_card&&value.token===self.subscription.credit_card.token){self.selectedCard=value;}});this.saveAndContinue=function(card){if(card.token){self.setCreditCard(card);}else{self.createCardOnServer(card).success(function(data,status,headers,config){self.setCreditCard(data);}).error(function(data,status,headers,config){self.messages='Error adding credit card.';self.error=true;});}};this.createCardOnServer=function(card){var encrypted=self.bt.encrypt(card.cc_number);return $http.post('/api/credit_cards/credit_card/',{'postal_code':card.postal_code,'expiration_month':card.expiration_month,'expiration_year':card.expiration_year,'cardholder_name':card.cardholder_name,'cc_number':encrypted,'cvv':card.cvv});};this.setCreditCard=function(card){self.selectedCardToken=card.token;document.getElementById("token").value=self.selectedCardToken;document.getElementById('complete_signup').submit();};}]);